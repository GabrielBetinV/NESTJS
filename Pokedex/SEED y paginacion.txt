** Crearemos un SEED para que tenga muchos registros en la base de datos

** Crear recurso llamado seed

nest g res seed --no-spec

Borrar los siguientes  archivos

- Todo el dto
- entities
- Borramos los end point del controlador y servicios



- Creamos un metodo en el servicio

import { Injectable } from '@nestjs/common';


@Injectable()
export class SeedService {


  executeSeed(){
    return 'Seed executed'
  }

}


- Invocamos el metodo en el controlador

import { Controller, Get, Post, Body, Patch, Param, Delete } from '@nestjs/common';
import { SeedService } from './seed.service';


@Controller('seed')
export class SeedController {
  constructor(private readonly seedService: SeedService) {}



  @Get()
  executeSeed() {
    return this.seedService.executeSeed();
  }


}


** Nota de actualización - Axios
En la siguiente clase, instalamos el paquete axios para realizar las peticiones HTTP.



En la última versión del mismo, está dando inconvenientes con NestJS (cannot read properties of undefined).

Pueden ver la issue sin resolver a día de hoy: https://github.com/axios/axios/issues/5100.



Por lo que a la hora de instalar axios, recomendamos instalen la versión 0.27.2 hasta que liberen
 una versión superior con el inconveniente solventado.

Pueden usar el comando yarn add axios@0.27.2 o npm install axios@0.27.2.

** Peticion HTTP desde Nest

- Instralar Axios

- Consumir la api de pokemon

import { Injectable } from '@nestjs/common';
import axios, {AxiosInstance} from 'axios';


@Injectable()
export class SeedService {

  private readonly axios: AxiosInstance =  axios;


  async executeSeed(){
    const {data } =  await this.axios.get('https://pokeapi.co/api/v2/pokemon?limit=650'); 
    return data
  }

}

- Consultarlo en Postm,an

- Copiar toda la respuesta

- Creamos una carpeta llamada interface dentro de la carpeta de seed

- Creamos el archivo poke-response.interface.ts

- Copiamos toda la respuesta de Postman, y lo dejamos en el porta papeles 

- Con el archivo creado y abierto, vamos a la paleta de comando y buscaamos

Paste JSON a code

- Se creara las interface de acuerdo a la data copiada

// Generated by https://quicktype.io

export interface PokeResponse {
    count:    number;
    next:     string;
    previous: null;
    results:  Result[];
}

export interface Result {
    name: string;
    url:  string;
}

- Agregamos el tipado de la respuesta segun la interface en el get del servicio

import { Injectable } from '@nestjs/common';
import axios, {AxiosInstance} from 'axios';
import { PokeResponse } from './interfaces/poke-response.interface';


@Injectable()
export class SeedService {

  private readonly axios: AxiosInstance =  axios;


  async executeSeed(){
    const {data } =  await this.axios.get<PokeResponse>('https://pokeapi.co/api/v2/pokemon?limit=650'); 
    return data
  }

}


- Recorremos el results y aplicamos split para obtener el no del pokemon

import { Injectable } from '@nestjs/common';
import axios, {AxiosInstance} from 'axios';
import { PokeResponse } from './interfaces/poke-response.interface';


@Injectable()
export class SeedService {

  private readonly axios: AxiosInstance =  axios;


  async executeSeed(){
    const {data } =  await this.axios.get<PokeResponse>('https://pokeapi.co/api/v2/pokemon?limit=10'); 
    
    //Recorremos la data para obtener  el nombre y la url
    data.results.forEach(({name, url}) => {

      // Realizamos un split a la URL y obtendremos la posicion en donde se encuentra el no del Pokemon
      const segments = url.split('/');
      console.log(segments)
      const no:number = + segments[segments.length -2];


      console.log({name,url,no})

    });

    return data.results
  }

}


** Insertar Pokemon en lote




